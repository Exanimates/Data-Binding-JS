class Model 
{
    constructor(mount, initial) 
    {
        this.mount = mount;
        this.initial = initial;
        this.sub = [];      
        var databind=document.querySelector(mount).querySelectorAll("[data-bind]");
        Array.from(databind).forEach(elem=>{                
            if (elem.type=="checkbox") 
                elem.addEventListener('change',()=>this.set(elem.dataset['bind'],elem.checked));
            else
            elem.addEventListener('input',()=>this.set(elem.dataset['bind'],elem.value));
            this.subscribe((key,value)=>{
                if (elem.dataset['bind']==key && (elem.tagName=="SPAN" || elem.tagName=="TEXT") )
                {
                    elem.innerHTML=value;
                    return;
                }       
                if (elem.dataset['bind'] == key && elem.type=="checkbox")
                    {
                      if (elem.type=="checkbox")  
                      elem.checked = value;
                        else elem.value=value;
                    }                             
            });
        })      
    }
    
        
    subscribe(fn)
    {
        this.sub.push(fn);        
    }
    
    set(key, value)
    {
        var keys = key.split(".");
         if  (key.length == 1)
		         this.initial[key] = value;
          else			   
			 {				
				var object = this.initial;
				for (var i=0;i<keys.length;i++)
					{
						if (typeof object[keys[i]]!='object' && typeof object[keys[i]]!='undefined')
							object[keys[i]] = value;
						else							
						   object = object[keys[i]];							
					}
			 } 
	  this.sub.forEach(l=>l(key,value));
    }

    get(key)
    {
        
    }
    toObject()
    {
        return this.initial;
    }
    
}



window.Model = Model